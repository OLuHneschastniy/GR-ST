<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Raport Pixel Style</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
/* === –ö–û–õ–¨–û–†–û–í–ê –ü–ê–õ–Ü–¢–†–ê === */
:root {
    /* –°–ï–†–ï–î–ù–Ø –¢–ï–ú–ê (Soft Light) */
    --md-sys-color-primary: #0061a4;
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #d1e4ff;
    --md-sys-color-on-primary-container: #001d36;
    
    /* –§–æ–Ω —Ç–µ–ø–µ—Ä –Ω–µ –±—ñ–ª–∏–π, –∞ –ø—Ä–∏—î–º–Ω–∏–π —Å—ñ—Ä–∏–π (Eye Comfort) */
    --md-sys-color-background: #e3e6ea; 
    
    /* –ö–∞—Ä—Ç–∫–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±—ñ–ª–∏–º–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É */
    --md-sys-color-surface: #ffffff; 
    
    --md-sys-color-surface-variant: #f1f3f4; /* –§–æ–Ω –ø–æ–ª—ñ–≤ –≤–≤–æ–¥—É */
    --md-sys-color-on-surface: #1a1c1e;
    --md-sys-color-on-surface-variant: #44474f;
    --md-sys-color-outline: #74777f;
    --md-sys-color-border: #c4c7c5; /* –ö–æ–ª—ñ—Ä —Ä–∞–º–∫–∏ –¥–ª—è Input */
    
    --md-sys-motion-easing: cubic-bezier(0.2, 0.0, 0, 1.0);
    --md-sys-shape-corner-large: 24px;
    --md-sys-shape-corner-medium: 12px;
    --md-sys-shape-corner-full: 999px;
    
    --shadow-soft: 0 2px 8px rgba(0,0,0,0.05);
}

/* –¢–ï–ú–ù–ê –¢–ï–ú–ê */
body.dark-mode {
    --md-sys-color-primary: #9ecaff;
    --md-sys-color-on-primary: #003258;
    --md-sys-color-primary-container: #00497d;
    --md-sys-color-on-primary-container: #d1e4ff;
    
    --md-sys-color-background: #121212; /* –ì–ª–∏–±–æ–∫–∏–π —á–æ—Ä–Ω–∏–π */
    --md-sys-color-surface: #1e1e1e;   /* –¢–µ–º–Ω–æ-—Å—ñ—Ä—ñ –∫–∞—Ä—Ç–∫–∏ */
    
    --md-sys-color-surface-variant: #2c2c2c;
    --md-sys-color-on-surface: #e2e2e6;
    --md-sys-color-on-surface-variant: #c4c6d0;
    --md-sys-color-outline: #8e9099;
    --md-sys-color-border: #44474f;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    font-family: 'Roboto', sans-serif;
    background-color: var(--md-sys-color-background);
    color: var(--md-sys-color-on-surface);
    margin: 0;
    padding: 20px;
    padding-bottom: 100px;
    transition: background-color 0.4s, color 0.4s;
    overflow-x: hidden;
}

/* === –ê–ù–Ü–ú–ê–¶–Ü–á === */
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}
.animate-enter { animation: fadeInUp 0.5s var(--md-sys-motion-easing) backwards; }

/* === –®–ê–ü–ö–ê === */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}
h1 { font-size: 22px; margin: 0; font-weight: 500; }

.icon-btn {
    background: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    border: none;
    width: 44px; height: 44px;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    box-shadow: var(--shadow-soft);
    display: flex; align-items: center; justify-content: center;
}

/* === –ö–ê–†–¢–ö–ò === */
.card {
    background: var(--md-sys-color-surface);
    border-radius: var(--md-sys-shape-corner-large);
    padding: 20px;
    margin-bottom: 16px;
    box-shadow: var(--shadow-soft); /* –ú'—è–∫–∞ —Ç—ñ–Ω—å –∑–∞–º—ñ—Å—Ç—å –±–æ—Ä–¥–µ—Ä–∞ */
}

h2 {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
    color: var(--md-sys-color-primary);
    margin: 0 0 15px 0;
    opacity: 0.9;
}

/* === –ü–†–Ø–ú–û–ö–£–¢–ù–Ü INPUTS (–ö–ª–∞—Å–∏—á–Ω–∏–π —Å—Ç–∏–ª—å) === */
.input-group { margin-bottom: 12px; }
label {
    display: block;
    font-size: 13px;
    color: var(--md-sys-color-on-surface-variant);
    margin-bottom: 6px;
    margin-left: 2px;
    font-weight: 500;
}
input, select, .file-btn {
    width: 100%;
    padding: 12px 14px; /* –ö–æ–º–ø–∞–∫—Ç–Ω—ñ—à—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ */
    background: var(--md-sys-color-surface); /* –§–æ–Ω —è–∫ —É –∫–∞—Ä—Ç–∫–∏ –∞–±–æ —Å–≤—ñ—Ç–ª—ñ—à–∏–π */
    color: var(--md-sys-color-on-surface);
    
    /* –ü–û–í–ù–ê –†–ê–ú–ö–ê (Box Style) */
    border: 1px solid var(--md-sys-color-border);
    border-radius: 10px; /* –ê–∫—É—Ä–∞—Ç–Ω–µ –∑–∞–æ–∫—Ä—É–≥–ª–µ–Ω–Ω—è */
    
    font-size: 16px;
    font-family: inherit;
    transition: 0.2s;
    appearance: none;
}

/* –ê–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω (Focus) */
input:focus, select:focus {
    outline: none;
    border-color: var(--md-sys-color-primary);
    box-shadow: 0 0 0 3px rgba(0, 97, 164, 0.15); /* –õ–µ–≥–∫–µ —Å–≤—ñ—Ç—ñ–Ω–Ω—è */
}

/* –§–∞–π–ª —ñ–Ω–ø—É—Ç */
.file-upload input { display: none; }
.file-btn { 
    text-align: center; 
    cursor: pointer; 
    border-style: dashed; 
    border-width: 2px;
    background: var(--md-sys-color-surface-variant);
}

.date-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.full { grid-column: span 2; }

/* === –í–ò–ü–†–ê–í–õ–ï–ù–ò–ô –ü–ï–†–ï–ú–ò–ö–ê–ß (Toggle) === */
.switch-container {
    display: flex;
    background: var(--md-sys-color-surface-variant); /* –°—ñ—Ä–∞ –ø—ñ–¥–∫–ª–∞–¥–∫–∞ */
    border-radius: 30px;
    padding: 4px; /* –í—ñ–¥—Å—Ç—É–ø –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–∞–ø—Å—É–ª–∏ */
    position: relative;
    height: 50px;
    margin-bottom: 10px;
    border: 1px solid var(--md-sys-color-border); /* –õ–µ–≥–∫–∞ –æ–±–≤–æ–¥–∫–∞ */
}

.switch-option {
    flex: 1;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    cursor: pointer;
    transition: color 0.3s;
    color: var(--md-sys-color-on-surface-variant);
    font-size: 14px;
    text-align: center;
}

/* –†—É—Ö–æ–º–∞ —á–∞—Å—Ç–∏–Ω–∞ (–ë—ñ–≥—É–Ω–æ–∫) */
.switch-bg {
    position: absolute;
    /* –í–ò–†–ê–•–û–í–£–Ñ–ú–û –®–ò–†–ò–ù–£: 50% –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º—ñ–Ω—É—Å –≤—ñ–¥—Å—Ç—É–ø 4px */
    width: calc(50% - 4px); 
    height: calc(100% - 8px); /* –í–∏—Å–æ—Ç–∞ –º—ñ–Ω—É—Å –≤—ñ–¥—Å—Ç—É–ø–∏ –∑–≤–µ—Ä—Ö—É/–∑–Ω–∏–∑—É (4+4) */
    top: 4px;
    left: 4px; /* –°—Ç–∞—Ä—Ç–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è –∑–ª—ñ–≤–∞ */
    background: var(--md-sys-color-background); /* –ö–æ–ª—ñ—Ä –±—ñ–≥—É–Ω–∫–∞ (–∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–∏–π) */
    border-radius: 26px;
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1);
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

/* –õ–æ–≥—ñ–∫–∞ —Ä—É—Ö—É */
/* –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ Left (–ø–µ—Ä—à–∏–π input), bg —Å—Ç–æ—ó—Ç—å –Ω–∞ –º—ñ—Å—Ü—ñ (transform: none –∞–±–æ 0) */
/* –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ Right, –∑—Å—É–≤–∞—î–º–æ –Ω–∞ 100% –≤–ª–∞—Å–Ω–æ—ó —à–∏—Ä–∏–Ω–∏ + –º–∞–ª–µ–Ω—å–∫–∏–π –∑–∞–∑–æ—Ä */
input[value="right"]:checked ~ .switch-bg { 
    transform: translateX(100%); 
    /* –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ translateX(calc(100% + —â–æ—Å—å)), —è–∫—â–æ —Ç—Ä–µ–±–∞, –∞–ª–µ –ø—Ä–∏ width calc(50%-4px) 100% –º–∞—î –±—É—Ç–∏ —ñ–¥–µ–∞–ª—å–Ω–æ */
}

/* –ó–º—ñ–Ω–∞ –∫–æ–ª—å–æ—Ä—É —Ç–µ–∫—Å—Ç—É –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ */
input[value="right"]:checked ~ label[for="sideRight"] { color: var(--md-sys-color-primary); }
input[value="left"]:checked ~ label[for="sideLeft"] { color: var(--md-sys-color-primary); }

.hidden-radio { display: none; }


/* === –°–ü–ò–°–ö–ò –ü–ê–† (–ü—Ä—è–º–æ–∫—É—Ç–Ω—ñ –±–ª–æ–∫–∏) === */
.pair-item {
    background: var(--md-sys-color-surface-variant);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 10px;
    border: 1px solid transparent;
}
.pair-item-header {
    font-weight: 700;
    color: var(--md-sys-color-primary);
    margin-bottom: 8px;
    font-size: 14px;
}
.pair-flex {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* === –°–¢–£–î–ï–ù–¢–ò === */
.student-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 0;
    border-bottom: 1px solid var(--md-sys-color-border);
}
.student-item:last-child { border-bottom: none; }

/* –¢—É–º–±–ª–µ—Ä –±—ñ–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ */
.m3-switch {
    position: relative; width: 48px; height: 28px;
    display: inline-block;
}
.m3-switch input { opacity: 0; width: 0; height: 0; }
.m3-slider {
    position: absolute; cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #e0e0e0; /* –°—ñ—Ä–∏–π –≤–∏–º–∫–Ω–µ–Ω–∏–π */
    border-radius: 34px;
    transition: .3s;
}
.m3-slider:before {
    position: absolute; content: "";
    height: 20px; width: 20px;
    left: 4px; bottom: 4px;
    background-color: white;
    transition: .3s; border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
input:checked + .m3-slider { background-color: var(--md-sys-color-primary); }
input:checked + .m3-slider:before { transform: translateX(20px); }

/* –î–µ—Ç–∞–ª—ñ —Å—Ç—É–¥–µ–Ω—Ç–∞ */
.student-details {
    display: grid; grid-template-rows: 0fr;
    transition: grid-template-rows 0.3s ease-out;
    background: var(--md-sys-color-surface-variant);
    border-radius: 12px; margin-top: 5px;
}
.details-inner { overflow: hidden; }
.details-content { padding: 15px; }

/* –ö–Ω–æ–ø–æ—á–∫–∏ –æ—Ü—ñ–Ω–æ–∫ (Bubbles) */
.chips-container {
    display: flex; justify-content: space-between; margin-top: 10px;
}
.chip {
    width: 38px; height: 38px;
    border-radius: 50%;
    background: var(--md-sys-color-surface);
    border: 1px solid var(--md-sys-color-border);
    display: flex; align-items: center; justify-content: center;
    font-weight: bold;
    color: var(--md-sys-color-on-surface-variant);
    transition: 0.2s;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.chip-input { display: none; }
.chip-input:checked + .chip {
    background: var(--md-sys-color-primary);
    color: white;
    border-color: var(--md-sys-color-primary);
    transform: scale(1.1);
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}

/* === –ì–û–õ–û–í–ù–ê –ö–ù–û–ü–ö–ê === */
.fab-container {
    position: fixed; bottom: 25px; left: 0; right: 0;
    display: flex; justify-content: center; z-index: 99;
    pointer-events: none;
}
.fab {
    pointer-events: auto;
    background: var(--md-sys-color-primary);
    color: white;
    border: none;
    height: 56px; padding: 0 40px;
    border-radius: 16px;
    font-size: 16px; font-weight: 600;
    box-shadow: 0 4px 12px rgba(0, 97, 164, 0.4);
    display: flex; align-items: center; gap: 10px;
    cursor: pointer;
    transition: transform 0.2s;
}
.fab:active { transform: scale(0.96); }

</style>
</head>
<body>

<div class="header animate-enter">
    <h1>–†–∞–ø–æ—Ä—Ç–∏—á–∫–∞</h1>
    <button class="icon-btn" onclick="toggleThemeManual()" id="themeIcon">‚òÄÔ∏è</button>
</div>

<div class="card animate-enter" style="animation-delay: 0.1s;">
    <h2>–†–µ–∂–∏–º –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è</h2>
    <div class="switch-container">
        <input type="radio" name="side" id="sideLeft" value="left" class="hidden-radio" checked onchange="updateSideVal()">
        <input type="radio" name="side" id="sideRight" value="right" class="hidden-radio" onchange="updateSideVal()">
        
        <div class="switch-bg"></div>
        
        <label for="sideLeft" class="switch-option">–õ—ñ–≤–∞</label>
        <label for="sideRight" class="switch-option">–ü—Ä–∞–≤–∞</label>
    </div>
    <input type="hidden" id="sideSelect" value="left">
</div>

<div class="card animate-enter" style="animation-delay: 0.2s;">
    <h2>1. –§–∞–π–ª —à–∞–±–ª–æ–Ω—É</h2>
    <div class="file-upload">
        <label for="uploadTemplate" class="file-btn" id="fileBtnText">
            üìÅ –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –æ–±—Ä–∞—Ç–∏ .xlsx
        </label>
        <input type="file" id="uploadTemplate" accept=".xlsx" onchange="handleFile(this)">
    </div>
</div>

<div class="card animate-enter" style="animation-delay: 0.3s;">
    <h2>2. –î–∞–Ω—ñ</h2>
    <div class="date-row">
        <div>
            <label>–î–µ–Ω—å</label>
            <input type="number" id="dayInput">
        </div>
        <div>
            <label>–†—ñ–∫</label>
            <input type="number" id="yearInput">
        </div>
        <div class="full">
            <label>–ú—ñ—Å—è—Ü—å</label>
            <select id="monthInput">
                <option value="0">–°—ñ—á–Ω—è</option>
                <option value="1">–õ—é—Ç–æ–≥–æ</option>
                <option value="2">–ë–µ—Ä–µ–∑–Ω—è</option>
                <option value="3">–ö–≤—ñ—Ç–Ω—è</option>
                <option value="4">–¢—Ä–∞–≤–Ω—è</option>
                <option value="5">–ß–µ—Ä–≤–Ω—è</option>
                <option value="6">–õ–∏–ø–Ω—è</option>
                <option value="7">–°–µ—Ä–ø–Ω—è</option>
                <option value="8">–í–µ—Ä–µ—Å–Ω—è</option>
                <option value="9">–ñ–æ–≤—Ç–Ω—è</option>
                <option value="10">–õ–∏—Å—Ç–æ–ø–∞–¥–∞</option>
                <option value="11">–ì—Ä—É–¥–Ω—è</option>
            </select>
        </div>
        <div class="full">
            <label>–ì—Ä—É–ø–∞</label>
            <input type="text" id="groupInput" value="85">
        </div>
    </div>
</div>

<div class="card animate-enter" style="animation-delay: 0.4s;">
    <h2>3. –†–æ–∑–∫–ª–∞–¥</h2>
    <div id="schedule"></div>
</div>

<div class="card animate-enter" style="animation-delay: 0.5s;">
    <h2>4. –í—ñ–¥—Å—É—Ç–Ω—ñ</h2>
    <div id="students"></div>
</div>

<div class="fab-container animate-enter" style="animation-delay: 0.6s;">
    <button class="fab" onclick="generateExcel()">
        <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel</span>
    </button>
</div>

<script>
// === THEME LOGIC ===
function checkAutoTheme() {
    const hour = new Date().getHours();
    const isDark = (hour >= 16 || hour < 7);
    if (isDark) document.body.classList.add('dark-mode');
    updateThemeIcon();
}
function toggleThemeManual() {
    document.body.classList.toggle('dark-mode');
    updateThemeIcon();
}
function updateThemeIcon() {
    const isDark = document.body.classList.contains('dark-mode');
    document.getElementById('themeIcon').innerText = isDark ? "üåô" : "‚òÄÔ∏è";
}
checkAutoTheme();

// === FILE LOGIC ===
function handleFile(input) {
    if(input.files[0]) {
        const btn = document.getElementById('fileBtnText');
        btn.innerText = "‚úÖ " + input.files[0].name;
        btn.style.borderColor = "var(--md-sys-color-primary)";
        btn.style.color = "var(--md-sys-color-primary)";
        btn.style.background = "var(--md-sys-color-primary-container)";
    }
}

// === MAIN JS ===
function updateSideVal() {
    const isLeft = document.getElementById('sideLeft').checked;
    document.getElementById('sideSelect').value = isLeft ? 'left' : 'right';
}

document.addEventListener('DOMContentLoaded', () => {
    const today = new Date();
    document.getElementById('dayInput').value = today.getDate();
    document.getElementById('monthInput').value = today.getMonth(); 
    document.getElementById('yearInput').value = today.getFullYear();
});

const students = [
  "–ë—ñ–ª–µ–π –ú.–î.","–ë–æ–Ω–¥–∞—Ä–µ—Ü—å –ú.–†.","–ì–∞—Ä–∫—É—à–∞ –†.–°.","–î–µ–º—á–µ–Ω–∫–æ –í.–ê.","–Ñ–≤—Å—Ç—Ä–∞—Ç–µ–Ω–∫–æ –Ü.–í.",
  "–ó–∞–π—á–µ–Ω–∫–æ –Ø.–ü.","–ö–∏—Ä–ø–∞ –ì.–°.","–ö–ª–∏–º–µ–Ω–∫–æ –°.–û.","–ö–æ–ª–µ—Å–æ–≤ –ú.–í.","–ö–æ–ª—ñ—Å–Ω—ñ—á–µ–Ω–∫–æ –Ü.–ë.",
  "–ö—Ä–∏–≤–µ–Ω–∫–æ –ú.–û.","–õ–µ–¥–Ω—å–æ–≤ –Ñ.–û.","–ú–∞—Å–∞–ª–æ–≤–∞ –í.–ú.","–ú—É—Ä–∑—ñ–Ω –¢.–ë.","–ù–µ—Ç—É–¥–∏—Ö–∞—Ç–∞ –ë.–°.",
  "–ü–∏—Å—å–º–µ–Ω–Ω–∏–π –¢.–†.","–ü—ñ–Ω—å–∫–æ–≤—Å—å–∫–∏–π –ê.–†.","–°–∞–º–∞—Ä–µ—Ü—å –Ü.–î.","–°–∏–¥–æ—Ä–µ–Ω–∫–æ –û.–°.","–°–∫–ª—è—Ä–µ–Ω–∫–æ –†.–Ü.",
  "–¢–∫–∞—á–µ–Ω–∫–æ –í.–ú.","–¢—Ä–µ—Ç—è–∫ –ì.–ü.","–®–µ—Ä–µ–º–µ—Ç –î.–°.","–®–∫—É—Ä–µ–Ω–∫–æ –ü.–ö.","–®—É–ª—å–≥–∞ –û.–ì."
];
const reasons = ["–Ω–µ–º.—ñ–Ω—Ç.","—ñ–Ω–¥.","—Å—ñ–º. –æ–±—Å—Ç.","–∑–∞—Ö–≤–æ—Ä—ñ–≤","–±–µ–∑ –ø–æ–≤.–ø—Ä–∏—á.","—Ö–≤–æ—Ä—ñ—î","—É –ª—ñ–∫–∞—Ä—è","–Ω–∞ –∫–æ–Ω–∫—É—Ä—Å—ñ","—Ç–µ—Ö–Ω. –ø—Ä–æ–±–ª.","–ø–æ–≥. —Å–∞–º–æ–ø–æ—á.","–≤—ñ–¥—Å—Ç–æ—Ä–æ–Ω–µ–Ω–∏–π","–∑–∞–ø—ñ–∑–Ω."];
const teachersDB = {
  "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó": "–ì–æ–Ω—á–∞—Ä–æ–≤ –û.–ú.", "–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞": "–¢–æ–∫–∞—Ä—î–≤–∞ –û.–í.", "–§—ñ–∑–∏–∫–∞ —ñ –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—è": "–ö–∞—Ä–ø–æ–≤–∞ –õ.–ú.",
  "–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó (–ú2 '–ö—Ä–µ—Å–ª–µ–Ω–Ω—è')": "–í–∞—Å–∏–ª—å—á–µ–Ω–∫–æ –Ü.–Ü.", "–û—Å–Ω–æ–≤–∏ —Ç–µ–æ—Ä—ñ—ó –∫—ñ–ª": "–ß–æ—Ä–Ω–∏–π –û.–ê.", "–§—ñ–∑–∏—á–Ω–∞ –∫—É–ª—å—Ç—É—Ä–∞": "–§—ñ–ª—ñ–ø–ø–æ–≤ –î.–í.",
  "–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞": "–ñ–∏—Ç—á–µ–Ω–∫–æ –Ü.–ú.", "–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó (–ú1 '–û—Å–Ω–æ–≤–∏')": "–ê–Ω–¥—Ä—î—î–≤ –í.–û.", "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞": "–ü—Ä–æ—â–µ–Ω–∫–æ –Ü.–ú.",
  "–ë—ñ–æ–ª–æ–≥—ñ—è —ñ –µ–∫–æ–ª–æ–≥—ñ—è": "–®–∞–π—Ç–∞–Ω–æ–≤–∞ –û.–ú.", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –ê–ª–≥–µ–±—Ä–∞": "–ö–æ–≤–∞–ª—å –Ü.–ê.", "–Ü—Å—Ç–æ—Ä—ñ—è –£–∫—Ä–∞—ó–Ω–∏": "–î–æ–º–Ω—ñ–Ω–∞ –ì.–°.", "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞": "–ü—Ä–æ—â–µ–Ω–∫–æ –Ü.–ú."
};
const monthNames = ["–°—ñ—á–Ω—è", "–õ—é—Ç–æ–≥–æ", "–ë–µ—Ä–µ–∑–Ω—è", "–ö–≤—ñ—Ç–Ω—è", "–¢—Ä–∞–≤–Ω—è", "–ß–µ—Ä–≤–Ω—è", "–õ–∏–ø–Ω—è", "–°–µ—Ä–ø–Ω—è", "–í–µ—Ä–µ—Å–Ω—è", "–ñ–æ–≤—Ç–Ω—è", "–õ–∏—Å—Ç–æ–ø–∞–¥–∞", "–ì—Ä—É–¥–Ω—è"];

// Generate Schedule
const schedule = document.getElementById("schedule");
for (let i = 0; i <= 4; i++) {
  schedule.innerHTML += `
    <div class="pair-item">
      <div class="pair-item-header">${i} –ø–∞—Ä–∞</div>
      <div class="pair-flex">
        <select id="subj_${i}" onchange="autoTeacher(${i})">
          <option value="">‚Äî –û–±–µ—Ä—ñ—Ç—å –ø—Ä–µ–¥–º–µ—Ç ‚Äî</option>
          ${Object.keys(teachersDB).map(s => `<option value="${s}">${s}</option>`).join("")}
          <option value="custom">–í–ø–∏—Å–∞—Ç–∏ –≤—Ä—É—á–Ω—É...</option>
        </select>
        <input id="teach_${i}" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –≤–∏–∫–ª–∞–¥–∞—á–∞">
      </div>
    </div>`;
}

function autoTeacher(i) {
  const subjEl = document.getElementById(`subj_${i}`);
  const teacherEl = document.getElementById(`teach_${i}`);
  if (teachersDB[subjEl.value]) teacherEl.value = teachersDB[subjEl.value];
  else if (subjEl.value !== "custom") teacherEl.value = "";
  
  const isSelected = (subjEl.value !== "");
  students.forEach((_, sIdx) => {
    document.querySelectorAll(`.p${sIdx}`).forEach(cb => {
       if (cb.value == i) { cb.checked = isSelected; }
    });
  });
}

// Generate Students
const studentsDiv = document.getElementById("students");
students.forEach((s, i) => {
  studentsDiv.innerHTML += `
    <div>
      <div class="student-item">
        <span style="font-weight:500; font-size:15px">${s}</span>
        <label class="m3-switch">
            <input type="checkbox" id="chk_${i}" onchange="toggle(${i})">
            <span class="m3-slider"></span>
        </label>
      </div>
      
      <div class="student-details" id="det_${i}">
        <div class="details-inner">
           <div class="details-content">
             <label>–ü—Ä–∏—á–∏–Ω–∞:</label>
             <select id="reason_${i}">${reasons.map(r => `<option>${r}</option>`).join("")}</select>
             
             <div style="margin-top:15px; font-size:13px; color:var(--md-sys-color-on-surface-variant); margin-bottom:5px">–ü—Ä–æ–ø—É—â–µ–Ω—ñ –ø–∞—Ä–∏:</div>
             <div class="chips-container">
               ${[0,1,2,3,4].map(p => `
                 <label>
                   <input type="checkbox" class="chip-input p${i}" value="${p}" id="p_${i}_${p}">
                   <div class="chip">${p}</div>
                 </label>
               `).join('')}
             </div>
           </div>
        </div>
      </div>
    </div>`;
});

function toggle(i) {
  const grid = document.getElementById(`det_${i}`);
  const checked = document.getElementById(`chk_${i}`).checked;
  grid.style.gridTemplateRows = checked ? "1fr" : "0fr";
}

// === EXCEL LOGIC (No changes) ===
function styleCell(cell, bold, size=11, italic=false) {
  cell.font = { name: "Times New Roman", size: size, bold: bold, italic: italic };
  cell.alignment = { horizontal: "center", vertical: "middle" };
}
async function generateExcel() {
  const file = document.getElementById("uploadTemplate").files[0];
  if (!file) { alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª —à–∞–±–ª–æ–Ω—É!"); return; }
  
  const side = document.getElementById("sideSelect").value;
  const cols = {
      header:   side === 'left' ? "A2" : "K2",
      subject:  side === 'left' ? "B"  : "L",
      teacher:  side === 'left' ? "C"  : "M",
      grades:   side === 'left' ? ["C","D","E","F","G"] : ["M","N","O","P","Q"], 
      total:    side === 'left' ? "H"  : "R"
  };

  const wb = new ExcelJS.Workbook();
  await wb.xlsx.load(await file.arrayBuffer());
  const ws = wb.getWorksheet(1);
  const day = document.getElementById('dayInput').value;
  const monthIdx = document.getElementById('monthInput').value;
  const yearFull = document.getElementById('yearInput').value.toString();
  const groupNum = document.getElementById('groupInput').value;
  const monthStr = monthNames[monthIdx];
  const yearPrefix = yearFull.substring(0, 2); 
  const yearSuffix = yearFull.substring(2, 4);

  const fontBase = { name: 'Times New Roman', size: 10 };
  const fontUnder = { name: 'Times New Roman', size: 10, underline: true };
  const fontYearPrefix = { name: 'Times New Roman', size: 10, bold: true, italic: true }; 
  const fontYearSuffix = { name: 'Times New Roman', size: 10, bold: true, italic: true, underline: true };

  const headerCell = ws.getCell(cols.header);
  headerCell.value = {
    richText: [
      { text: '"', font: fontBase }, { text: '  ' + day + '  ', font: fontUnder }, { text: '"   ', font: fontBase },
      { text: '   ' + monthStr, font: fontUnder }, { text: ' ', font: fontBase },
      { text: yearPrefix, font: fontYearPrefix }, { text: yearSuffix, font: fontYearSuffix },
      { text: ' —Ä.  –ì—Ä. ‚Ññ', font: fontBase }, { text: '  ' + groupNum + '  ', font: fontUnder }, { text: '.', font: fontBase }
    ]
  };
  headerCell.alignment = { horizontal: "center", vertical: "middle" };

  const rowMap = {0:4, 1:5, 2:6, 3:7, 4:8}; 
  for (let i = 0; i <= 4; i++) {
    const subjVal = document.getElementById(`subj_${i}`).value;
    const teachVal = document.getElementById(`teach_${i}`).value;
    if (subjVal || teachVal) {
        ws.getCell(`${cols.subject}${rowMap[i]}`).value = subjVal;
        ws.getCell(`${cols.teacher}${rowMap[i]}`).value = teachVal;
        styleCell(ws.getCell(`${cols.subject}${rowMap[i]}`), false);
        styleCell(ws.getCell(`${cols.teacher}${rowMap[i]}`), false);
    }
  }

  let row = 11; 
  students.forEach((s, i) => {
    if(document.getElementById(`chk_${i}`).checked){
      const reason = document.getElementById(`reason_${i}`).value;
      const nameCell = ws.getCell(`${cols.subject}${row}`);
      nameCell.value = `${s} (${reason})`;
      nameCell.font = { name: "Times New Roman", size: 11, italic: false };
      nameCell.alignment = { horizontal: "center", vertical: "middle" };

      let hours = 0;
      document.querySelectorAll(`.p${i}:checked`).forEach(p => {
        const colLetter = cols.grades[p.value];
        if (colLetter) {
            ws.getCell(`${colLetter}${row}`).value = "2";
            styleCell(ws.getCell(`${colLetter}${row}`), true, 11, false);
            hours += 2;
        }
      });

      ws.getCell(`${cols.total}${row}`).value = hours;
      styleCell(ws.getCell(`${cols.total}${row}`), true, 11, false);
      row++;
    }
  });

  const buf = await wb.xlsx.writeBuffer();
  const sideSuffix = side === 'left' ? '_Left' : '_Right';
  saveAs(new Blob([buf]), `raport_${day}_${monthStr}${sideSuffix}.xlsx`);
}
</script>
</body>
</html>
